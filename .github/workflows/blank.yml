name: Terraform Workflow

on:
  push:
    branches:
      - main

jobs:
  terraform:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Create Variable File
      run: | 
        touch secret.tfvars
        echo aws_access_key = \"AKIAUGLXYA4B52PMXRGI\" >> secret.tfvars
        echo aws_secret_key = \"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\" >> secret.tfvars
        echo IP = \"76.132.254.214/32\" >> secret.tfvars
        cat secret.tfvars

    - name: Install Terraform
      run: |
        sudo apt-get update && sudo apt-get install -y unzip
        wget https://releases.hashicorp.com/terraform/0.15.5/terraform_0.15.5_linux_amd64.zip
        unzip terraform_0.15.5_linux_amd64.zip
        sudo mv terraform /usr/local/bin/
        terraform --version

    - name: Initialize Terraform
      run: |
        terraform init

    - name: Apply Terraform Configuration
      run: |
        terraform apply -refresh=true	-var-file="secret.tfvars"
